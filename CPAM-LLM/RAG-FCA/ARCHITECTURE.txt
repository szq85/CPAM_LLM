RAG-FCA SYSTEM ARCHITECTURE
============================

┌─────────────────────────────────────────────────────────────────────┐
│                     USER INPUT (Natural Language)                   │
│  "Reconfigurable photovoltaic energy storage system optimization"  │
└─────────────────────────┬───────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   ATTRIBUTE EXTRACTION MODULE                       │
│  • Keyword matching                                                 │
│  • Pattern recognition                                              │
│  Output: {battery_voltage_range, energy_loss_minimization, ...}   │
└─────────────────────────┬───────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────┐
│              FORMAL BACKGROUND K = (G, M, I)                        │
│  ┌──────────────┬──────────────┬──────────────┐                   │
│  │ Objects (G)  │ Attributes(M)│ Relations(I) │                   │
│  ├──────────────┼──────────────┼──────────────┤                   │
│  │ battery_opt_1│ voltage_range│ (obj,attr)∈I │                   │
│  │ pv_storage_1 │ energy_loss  │ μ(obj,attr)  │                   │
│  │ vrp_1        │ capacity     │ [0,1] fuzzy  │                   │
│  └──────────────┴──────────────┴──────────────┘                   │
└─────────────────────────┬───────────────────────────────────────────┘
                          │
                ┌─────────┴──────────┐
                │                    │
                ▼                    ▼
┌──────────────────────────┐  ┌──────────────────────────┐
│   CONCEPT LATTICE L(K)   │  │  ROUGH SET PROCESSOR     │
│  • Build concepts (A,B)  │  │  • Indiscernibility IND  │
│  • Partial order ≤       │  │  • Lower approximation   │
│  • Jaccard similarity    │  │  • Upper approximation   │
└──────────┬───────────────┘  └────────┬─────────────────┘
           │                           │
           │ Semantic                  │ Implicit
           │ Disambiguation            │ Constraints
           │                           │
           └────────┬──────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  QUERY AUGMENTATION                                 │
│  • Matched concept: C* = (A*, B*)                                  │
│  • Augmented query: Q' ∪ Constraints_certain                       │
│  • Possible suggestions: Constraints_possible                      │
└─────────────────────────┬───────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    CONTEXT BUILDER                                  │
│  • Domain information from matched concept                         │
│  • Core attributes from augmentation                               │
│  • Possible additional attributes                                  │
└─────────────────────────┬───────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    PROMPT GENERATOR                                 │
│  Structured prompt with:                                           │
│  • Problem description                                             │
│  • Domain context                                                  │
│  • Attribute information                                           │
│  • Output format specification                                     │
└─────────────────────────┬───────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    LLM API (Claude)                                 │
│  Model: claude-sonnet-4-20250514                                   │
│  Max tokens: 4096                                                  │
└─────────────────────────┬───────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────┐
│               RESPONSE PARSER & STRUCTURER                          │
│  • Parse JSON response                                             │
│  • Validate structure                                              │
│  • Add metadata                                                    │
└─────────────────────────┬───────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   FORMAL DESCRIPTION OUTPUT                         │
│  {                                                                  │
│    "decision_variables": [...],                                    │
│    "objective": {...},                                             │
│    "constraints": [...],                                           │
│    "parameters": [...],                                            │
│    "metadata": {...}                                               │
│  }                                                                  │
└─────────────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────┐
│              KNOWLEDGE BASE UPDATE (Optional)                       │
│  • Store verified problem instance                                 │
│  • Update formal background                                        │
│  • Rebuild concept lattice                                         │
│  • Enable continuous learning                                      │
└─────────────────────────────────────────────────────────────────────┘


KEY MATHEMATICAL OPERATIONS
============================

1. Prime Operations (Galois Connections):
   A' = {m ∈ M | ∀g ∈ A, (g,m) ∈ I}
   B' = {g ∈ G | ∀m ∈ B, (g,m) ∈ I}

2. Formal Concepts:
   (A,B) where A' = B and B' = A

3. Partial Order:
   (A₁,B₁) ≤ (A₂,B₂) ⟺ A₁ ⊆ A₂ ⟺ B₂ ⊆ B₁

4. Jaccard Similarity:
   score(Q,B) = |Q ∩ B| / |Q ∪ B|

5. Fuzzy Jaccard:
   score_f(Q,B) = Σ min(μ_Q(m), μ_B(m)) / Σ max(μ_Q(m), μ_B(m))

6. Lower Approximation (Certain):
   apr_B(A) = {g ∈ G | [g]_IND(B) ⊆ A}

7. Upper Approximation (Possible):
   apr̄_B(A) = {g ∈ G | [g]_IND(B) ∩ A ≠ ∅}

8. Query Augmentation:
   Q_augmented = Q' ∪ Constraints_certain(Q')


SYSTEM WORKFLOW
===============

1. Extract → Parse natural language to identify key attributes
2. Match → Find similar problems in knowledge base via concept lattice
3. Disambiguate → Resolve ambiguous terms using semantic similarity
4. Augment → Discover implicit constraints via rough sets
5. Generate → Create formal description using LLM with enriched context
6. Structure → Parse and validate the formal mathematical description
7. Learn → Optionally update knowledge base with verified instances
